<% if current_user %>
	<%= button_to "管理員登出", destroy_user_session_path, method: :delete, data: { :no_turbolink => true } %>
<% else %>
	<%= button_to "管理員登入", new_user_session_path, method: :get %>
<% end %>

<div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-8">拍賣商品服務資料</h1>
			<%= link_to "管理HTML範本", templates_path, class: "btn btn-success" %>
  </div>
</div>

	<% flash.each do |key, value| %>
  <%= content_tag :div, value, class: "flash #{key}", style: "color:red;" %>
	<% end %>
<div class="container-fluid">
	<div class="row">
		<div class="col-md-4">
			<h3>
				品牌
				<%= link_to "+", new_brand_path, class: "btn btn-success" %>
			</h3>
      <div class="list-group">
        <% @brands.each do |brand| %>
				<div class="row">
					<% if @current_brand.id.to_s == brand.id.to_s %>
					<div class="col-md-9">
						<%= link_to "#{brand.name}", 
							root_path(brand_id: brand.id), 
							class: "list-group-item list-group-item-action active"
						%>
					</div>
					<div class="col-md-3">
						<div class="btn-group" role="group">
							<%= button_to "編輯", edit_brand_path(brand), method: :get, class: "btn btn-info btn-xs"%>
						</div>
					</div>
					<% else %>
					<div class="col-md-9">
							<%= link_to "#{brand.name}", 
								root_path(brand_id: brand.id), 
								class: "list-group-item list-group-item-action" 
							%>
					</div>
					<% end %>
				</div>
        <% end %>
      </div>
		</div>
		<div class="col-md-4">
			<h3>
				商品
				<% if @current_brand %>
					<%= link_to "+", new_brand_product_path(@current_brand), class: "btn btn-success" %>
				<% end %>
			</h3>
			<div class="list-group">
        <% @products.each do |product| %>
					<div class="row">
							<% if @current_product.id.to_s == product.id.to_s %>
								<div class="col-md-9">
									<%= link_to "#{product.name}", root_path(brand_id: product.brand_id, product_id: product.id), class: "list-group-item list-group-item-action active" %>
								</div>
								<div class="col-md-3">
									<div class="btn-group" role="group">
										<%# <%= button_to "露天html", product_path(product), method: :get, class: "btn btn-success btn-xs"%> 
										<%= link_to "html", brand_product_templates_path(@current_brand, product), class: "btn btn-primary btn-xs"%>
										<%= button_to "編輯", edit_brand_product_path(@current_brand, product), method: :get, class: "btn btn-info btn-xs"%>
									</div>
								</div>
							<% else %>
								<div class="col-md-9">
									<%= link_to "#{product.name}", root_path(brand_id: product.brand_id, product_id: product.id), class: "list-group-item list-group-item-action" %>
								</div>
							<% end %>
					</div>					
        <% end %>
			</div> 
		</div>
			<div class="col-md-4">
				<h3>
					商品規格
					<% if @current_brand && @current_product %>
						<%= link_to "+", new_brand_product_service_path(@current_brand, @current_product), class:"btn btn-success" %>
					<% end %>
				</h3>
				<table class="table">
					<thead>
						<tr>
							<th>
								#
							</th>
							<th>
								服務
							</th>
							<th>
								yahoo價格
							</th>
							<th>
								ruten價格
							</th>
							<th>
								shopee價格
							</th>
							<th>
							</th>
						</tr>
					</thead>
					<tbody>
					<% @services.each_with_index do |service, index| %>
						<tr>
							<td>
								<%= index + 1 %>
							</td>
							<td>
								<%= service[:name] %>
							</td>
							<td>
								<%= Price.find_by(product: @current_product, service: service).yahoo if Price.find_by(product: @current_product, service: service) %>
							</td>
							<td>
								<%= Price.find_by(product: @current_product, service: service).ruten if Price.find_by(product: @current_product, service: service) %>
							</td>
							<td>
								<%= Price.find_by(product: @current_product, service: service).shopee if Price.find_by(product: @current_product, service: service) %>
							</td>
							<td>
								<%= button_to "編輯", edit_brand_product_service_path(@current_brand, @current_product, service), method: :get, class: "btn btn-info btn-xs"%>
							</td>
						</tr>
						<% end %>
					</tbody>
				</table> 
		</div>
	</div>
</div>
